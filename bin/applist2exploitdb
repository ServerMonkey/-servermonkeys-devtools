#!/bin/sh
#info: Generate a list of possible exploits from a list of applications

###### PARAMETERS #############################################################

# help
if [ -z "$1" ] || [ "$1" = "-h" ] || [ "$1" = "--help" ]; then
    echo "Generate a list of possible exploits from a list of applications"
    echo ""
    echo "Example use: applist2exploitdb ./my_in_list.txt ./out"
    echo "This will create two files: 'out_exploits.csv' and 'out_exploits.txt'"
    exit 0
fi

if [ -z "$(command -v searchsploit)" ]; then
    echo "searchsploit is not installed. Install to make this program work."
    exit 1
fi

FILE_APPS="$1"
FILE_OUT="$2"

# verify
if ! [ -f "$FILE_APPS" ]; then
    echo "missing input file"
    exit 1
fi
if [ -z "$FILE_OUT" ]; then
    echo "FILE_OUT not found"
    exit 1
fi

GREEN=$(tput setaf 2)
NOCOL=$(tput sgr0)

###### MAIN ###################################################################

FILE_OUT_EXPLOITS="$FILE_OUT""_exploits.csv"
FILE_OUT_APPS="$FILE_OUT""_exploits.txt"

rm -f "$FILE_OUT_EXPLOITS" "$FILE_OUT_APPS"

LIST_APPS=$(cat "$FILE_APPS")
for i in $LIST_APPS; do
    APP=$(echo "$i" | tr "-" " " | tr "_" " ")
    printf "\n%s" "$APP"
    RESULT=$(searchsploit --colour -st "$APP" 2>/dev/null | grep -i "$APP" |
        awk '{$1=$1;print}' | sed 's/| /,/g' | sed 's/ - /,/g')
    if [ -n "$RESULT" ]; then
        printf "%s" " -> ${GREEN}FOUND${NOCOL}"
        echo "$i" >>"$FILE_OUT_APPS"
        echo "$RESULT" >>"$FILE_OUT_EXPLOITS"
    fi
done
echo ""
